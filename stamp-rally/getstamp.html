<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  
        <meta content="width=device-width, initial-scale=1.0,
        minimum-scale=1.0, maximum-scale=1.0">
  <title>スタンプ取得中...</title>
  <script>
    const TEST_MODE = true; // ← true の間は何回でもスタンプ取得OK！

    async function getStamp() {
      const params = new URLSearchParams(location.search);
      const spot = params.get("spot"); // A または B

      if (!spot) {
        document.body.textContent = "エラー：無効なURLです。";
        return;
      }

      // ローカル保存を読み込む
      const stamps = JSON.parse(localStorage.getItem("stamps") || "{}");

      // すでに取得済みならスキップ（ただしテストモード時は無視）
      if (!TEST_MODE && stamps[spot]) {
        document.body.textContent = `スタンプ「${spot}」はすでに取得済みです。`;
        return;
      }

      // スタンプ取得を記録（上書きOK）
      stamps[spot] = new Date().toISOString();
      localStorage.setItem("stamps", JSON.stringify(stamps));

      document.body.textContent = `🎉 スタンプ「${spot}」をゲットしました！`;

      // GASに記録
      await fetch("https://script.google.com/macros/s/AKfycbzrcTtzMZvswUeK5X1bCnZIlXZ7ta0DKylpTqNzTKsvKfL-kFObnoIxIbrlVtlk0qpJCw/exec", {
        method: "POST",
        body: JSON.stringify({
          spot,
          timestamp: new Date().toLocaleString(),
          clientId: localStorage.getItem("clientId") || (() => {
            const id = crypto.randomUUID();
            localStorage.setItem("clientId", id);
            return id;
          })()
        })
      });

      // 数秒後に台紙へ戻る
      setTimeout(() => location.href = "index.html", 2000);
    }

    window.onload = getStamp;
  </script>
</head>
<body>
  <p>スタンプを取得中です...</p>
</body>
</html>
